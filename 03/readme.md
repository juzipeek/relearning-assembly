# gcc 内嵌汇编

## 输出/输出限定

gcc 内嵌汇编使用 at&t 汇编语法, 内嵌汇编语句以 `__asm__` 开头, 在括号中包含`汇编指令模板`. `汇编指令模板` 由`汇编指令序列`与`限定字符串`组成. 在`汇编指令序列`中可以使用 `%0`~`%9` 共十个占位符引用 C 语言中的变量.

在`限定字符串`中可以对占位符进行限定, 限定内容包括: 占位符与哪个 C 语言变量绑定, 可以是什么操作数类型.`限定字符串`分为三个部分: 输出操作数占位符限定, 输入操作数占位符限定, 修改操作数占位符限定.

在`限定字符串`中出现的第一个限定字符串用于描述占位符 `%0`, 第二个用于描述占位符 `%1`, 以此类推(最大到 `%9`).

在`输出操作数占位符限定`中绑定的 C 语言变量必须是左值类型(变量必须是可写的). 如果一个绑定变量即是输入操作数又是输出操作数, 则应该分别在输出限定描述, 输入限定描述中进行说明. 并且在`输入限定`描述中应该引用`输出限定`描述中的`占位符`, 才能保证两者地址相同.

- *输出操作数的含义是: 操作数是汇编指令的目的操作数.对应输入操作数是汇编指令的源操作数.*

以下示例:

```c
int add(int foo, int bar)
{
    __asm__ __volatile__(
        "addl %2, %0"
        : "=r"(foo) // 输出占位符限定部分,`%0` 占位符限定
        : "0"(foo), // 输入占位符限定部分, "0" 表示与占位符 `%0` 绑定
          "g"(bar)  // `%2` 占位符限定
    );
    return foo;
}
```

## 修改限定

有些汇编指令可能会修改某些寄存器的值, 在汇编指令模板中必须将这种情况通知编译器. 在模板中 `修改操作数占位符限定` 实现此功能.
